<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Gestión Farmacias Zona 1561 — sistema corporativo de gestión y control" />
  <title>Gestión Farmacias Zona 1561</title>

  <!-- Font Awesome (considerar agregar integrity + crossorigin si es posible) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <!-- Estilos propios -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header class="header" role="banner">
      <h1>
        <i class="fas fa-pills" aria-hidden="true"></i>
        Gestión Farmacias Zona 1561
      </h1>
      <p>Sistema corporativo de gestión y control</p>
    </header>

    <main>
      <!-- Estado de conexión -->
      <div id="connectionStatus" class="connection-status" role="status" aria-live="polite">
        <div class="status-card" id="statusCard">
          <i class="fas fa-spinner fa-spin" id="statusIcon" aria-hidden="true"></i>
          <h3 id="statusTitle">Conectando...</h3>
          <p id="statusMessage">Inicializando sistema...</p>
        </div>
      </div>

      <!-- Estadísticas -->
      <section class="stats-container" aria-label="Estadísticas">
        <article class="stat-card" aria-labelledby="farmaciasLabel">
          <i class="fas fa-store" aria-hidden="true"></i>
          <div class="stat-info">
            <span class="stat-number" id="totalFarmacias">0</span>
            <span class="stat-label" id="farmaciasLabel">Farmacias</span>
          </div>
        </article>

        <article class="stat-card" aria-labelledby="conTelefonoLabel">
          <i class="fas fa-phone" aria-hidden="true"></i>
          <div class="stat-info">
            <span class="stat-number" id="conTelefono">0</span>
            <span class="stat-label" id="conTelefonoLabel">Con Teléfono</span>
          </div>
        </article>

        <article class="stat-card" aria-labelledby="ultimaActLabel">
          <i class="fas fa-clock" aria-hidden="true"></i>
          <div class="stat-info">
            <span class="stat-number" id="ultimaActualizacion">--:--</span>
            <span class="stat-label" id="ultimaActLabel">Última Actualización</span>
          </div>
        </article>
      </section>

      <!-- Panel de Gestión -->
      <section class="management-panel" aria-label="Panel de gestión">
        <div class="panel-header">
          <h2><i class="fas fa-cogs" aria-hidden="true"></i> Panel de Gestión</h2>

          <div class="panel-actions">
            <button id="btnAdd" type="button" class="btn btn-primary" aria-haspopup="dialog">
              <i class="fas fa-plus" aria-hidden="true"></i> Agregar Farmacia
            </button>

            <button id="btnExport" type="button" class="btn btn-success">
              <i class="fas fa-file-excel" aria-hidden="true"></i> Exportar
            </button>

            <button id="btnRefresh" type="button" class="btn btn-info">
              <i class="fas fa-sync" aria-hidden="true"></i> Actualizar
            </button>
          </div>
        </div>

        <!-- Búsqueda -->
        <div class="search-section">
          <label class="search-container" for="searchInput">
            <i class="fas fa-search" aria-hidden="true"></i>
            <input id="searchInput" type="search" placeholder="Buscar por nombre, teléfono o descripción..." />
          </label>

          <div class="search-filters">
            <label for="filterTelefono" class="sr-only">Filtrar por teléfono</label>
            <select id="filterTelefono" name="filterTelefono">
              <option value="">Todos</option>
              <option value="con">Con Teléfono</option>
              <option value="sin">Sin Teléfono</option>
            </select>
          </div>
        </div>

        <!-- Tabla de farmacias -->
        <div class="farmacia-list">
          <div class="table-container" role="region" aria-label="Listado de farmacias">
            <table class="farmacia-table">
              <caption class="sr-only">Listado de farmacias registradas</caption>
              <thead>
                <tr>
                  <th scope="col">Nombre</th>
                  <th scope="col">Teléfono</th>
                  <th scope="col">Descripción</th>
                  <th scope="col">Acciones</th>
                </tr>
              </thead>
              <tbody id="farmaciaTableBody">
                <!-- Las farmacias se cargarán aquí desde script.js -->
              </tbody>
            </table>
          </div>

          <div id="emptyState" class="empty-state hidden" aria-hidden="true">
            <i class="fas fa-store" aria-hidden="true"></i>
            <h3>No hay farmacias registradas</h3>
            <p>Comienza agregando tu primera farmacia</p>
            <button id="btnAddFirst" type="button" class="btn btn-primary">
              <i class="fas fa-plus" aria-hidden="true"></i> Agregar Primera Farmacia
            </button>
          </div>
        </div>
      </section>

      <!-- Modal Agregar/Editar Farmacia -->
      <div id="farmaciaModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true" tabindex="-1">
        <div class="modal-overlay" id="modalOverlay" data-closeable="true"></div>
        <div class="modal-content" role="document">
          <div class="modal-header">
            <h3 id="modalTitle">Agregar Farmacia</h3>
            <button id="modalClose" type="button" class="close" aria-label="Cerrar">&times;</button>
          </div>

          <form id="farmaciaForm" novalidate>
            <div class="form-group">
              <label for="farmaciaNombre">
                <i class="fas fa-store" aria-hidden="true"></i>
                Nombre de la Farmacia *
              </label>
              <input
                type="text"
                id="farmaciaNombre"
                name="farmaciaNombre"
                required
                placeholder="Ej: Farmacia San Rafael"
                autocomplete="organization"
              />
              <span class="error-message" id="errorNombre" aria-live="polite"></span>
            </div>

            <div class="form-group">
              <label for="farmaciaTelefono">
                <i class="fas fa-phone" aria-hidden="true"></i>
                Teléfono
              </label>
              <input
                type="tel"
                id="farmaciaTelefono"
                name="farmaciaTelefono"
                placeholder="Ej: 3001234567"
                autocomplete="tel"
                pattern="[0-9]{7,15}"
              />
              <span class="error-message" id="errorTelefono" aria-live="polite"></span>
            </div>

            <div class="form-group">
              <label for="farmaciaDescripcion">
                <i class="fas fa-clipboard-list" aria-hidden="true"></i>
                Descripción
              </label>
              <textarea
                id="farmaciaDescripcion"
                name="farmaciaDescripcion"
                rows="4"
                placeholder="Información adicional, horarios, contactos..."
              ></textarea>
            </div>

            <div class="form-actions">
              <button id="cancelForm" type="button" class="btn btn-secondary">Cancelar</button>
              <button id="submitForm" type="submit" class="btn btn-primary">
                <i class="fas fa-save" aria-hidden="true"></i> Guardar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Registro de actividad -->
      <section class="activity-section" aria-label="Registro de actividades">
        <h3><i class="fas fa-list" aria-hidden="true"></i> Registro de Actividades</h3>
        <div id="logContainer" class="log-container" role="log" aria-live="polite"></div>
        <button id="clearLogBtn" type="button" class="btn btn-secondary">
          <i class="fas fa-broom" aria-hidden="true"></i> Limpiar Registro
        </button>
      </section>
    </main>

    <footer class="site-footer" role="contentinfo">
      <p>Gestión Farmacias Zona 1561 — &copy; <span id="anioActual"></span></p>
    </footer>
  </div>

  <noscript>
    <div class="no-js-warning">Esta aplicación requiere JavaScript para funcionar correctamente.</div>
  </noscript>

  <!-- Módulo de inicialización de Firebase (externalizar la configuración sensible y reglas en Firestore) -->
  <script type="module" src="firebase-init.js"></script>

  <!-- Librería para exportar Excel (si la usas) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- Lógica principal: listeners, apertura/cierre modal, render seguro de datos, focus trap, etc. -->
  <script src="script.js" defer></script>
</body>
</html>
