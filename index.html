<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n Farmacias Zona 1561</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet"> <!-- Actualizado a versi√≥n m√°s reciente -->
</head>
<body>
    <div class="container">
        <!-- Header Corporativo -->
        <header class="header">
            <h1><i class="fas fa-pills"></i> Gesti√≥n Farmacias Zona 1561</h1>
            <p>Sistema corporativo de gesti√≥n y control</p>
        </header>

        <!-- Estado de Conexi√≥n -->
        <section class="connection-status" id="connectionStatus" aria-live="polite"> <!-- Agregado ARIA para accesibilidad -->
            <div class="status-card">
                <i class="fas fa-spinner fa-spin" id="statusIcon" aria-hidden="true"></i>
                <h3 id="statusTitle">Conectando...</h3>
                <p id="statusMessage">Inicializando sistema...</p>
            </div>
        </section>

        <!-- Estad√≠sticas -->
        <section class="stats-container">
            <div class="stat-card">
                <i class="fas fa-store" aria-hidden="true"></i>
                <div class="stat-info">
                    <span class="stat-number" id="totalFarmacias">0</span>
                    <span class="stat-label">Farmacias</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-phone" aria-hidden="true"></i>
                <div class="stat-info">
                    <span class="stat-number" id="conTelefono">0</span>
                    <span class="stat-label">Con Tel√©fono</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock" aria-hidden="true"></i>
                <div class="stat-info">
                    <span class="stat-number" id="ultimaActualizacion">--:--</span>
                    <span class="stat-label">√öltima Actualizaci√≥n</span>
                </div>
            </div>
        </section>

        <!-- Panel de Gesti√≥n -->
        <section class="management-panel">
            <div class="panel-header">
                <h2><i class="fas fa-cogs" aria-hidden="true"></i> Panel de Gesti√≥n</h2>
                <div class="panel-actions">
                    <button onclick="showAddModal()" class="btn btn-primary">
                        <i class="fas fa-plus" aria-hidden="true"></i> Agregar Farmacia
                    </button>
                    <button onclick="exportData()" class="btn btn-success">
                        <i class="fas fa-file-excel" aria-hidden="true"></i> Exportar
                    </button>
                    <button onclick="loadFarmacias()" class="btn btn-info">
                        <i class="fas fa-sync" aria-hidden="true"></i> Actualizar
                    </button>
                </div>
            </div>

            <!-- B√∫squeda -->
            <div class="search-section">
                <div class="search-container">
                    <i class="fas fa-search" aria-hidden="true"></i>
                    <input type="text" id="searchInput" placeholder="Buscar por nombre, tel√©fono o descripci√≥n..." aria-label="B√∫squeda de farmacias">
                </div>
                <div class="search-filters">
                    <select id="filterTelefono" aria-label="Filtro por tel√©fono">
                        <option value="">Todos</option>
                        <option value="con">Con Tel√©fono</option>
                        <option value="sin">Sin Tel√©fono</option>
                    </select>
                </div>
            </div>

            <!-- Tabla de Farmacias -->
            <div class="farmacia-list">
                <div class="table-container">
                    <table class="farmacia-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Tel√©fono</th>
                                <th>Descripci√≥n</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="farmaciaTableBody">
                            <!-- Las farmacias se cargar√°n aqu√≠ -->
                        </tbody>
                    </table>
                </div>
                <div id="emptyState" class="empty-state"> <!-- Estilo movido a CSS -->
                    <i class="fas fa-store" aria-hidden="true"></i>
                    <h3>No hay farmacias registradas</h3>
                    <p>Comienza agregando tu primera farmacia</p>
                    <button onclick="showAddModal()" class="btn btn-primary">
                        <i class="fas fa-plus" aria-hidden="true"></i> Agregar Primera Farmacia
                    </button>
                </div>
            </div>
        </section>

        <!-- Modal para Agregar/Editar -->
        <dialog id="farmaciaModal" class="modal" aria-modal="true"> <!-- Cambiado a <dialog> para sem√°ntica moderna -->
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Agregar Farmacia</h3>
                    <button class="close" onclick="closeModal()" aria-label="Cerrar modal">&times;</button>
                </div>
                <form id="farmaciaForm">
                    <div class="form-group">
                        <label for="farmaciaNombre">
                            <i class="fas fa-store" aria-hidden="true"></i> Nombre de la Farmacia *
                        </label>
                        <input type="text" id="farmaciaNombre" required placeholder="Ej: Farmacia San Rafael">
                    </div>
                    <div class="form-group">
                        <label for="farmaciaTelefono">
                            <i class="fas fa-phone" aria-hidden="true"></i> Tel√©fono
                        </label>
                        <input type="tel" id="farmaciaTelefono" placeholder="Ej: 3001234567">
                    </div>
                    <div class="form-group">
                        <label for="farmaciaDescripcion">
                            <i class="fas fa-clipboard-list" aria-hidden="true"></i> Descripci√≥n
                        </label>
                        <textarea id="farmaciaDescripcion" rows="4" placeholder="Informaci√≥n adicional, horarios, contactos, observaciones..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">
                            <i class="fas fa-times" aria-hidden="true"></i> Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save" aria-hidden="true"></i> Guardar
                        </button>
                    </div>
                </form>
            </div>
        </dialog>

        <!-- Activity Log -->
        <section class="activity-section">
            <h3><i class="fas fa-list" aria-hidden="true"></i> Registro de Actividades</h3>
            <div id="logContainer" class="log-container"></div>
            <button onclick="clearLog()" class="btn btn-secondary">
                <i class="fas fa-broom" aria-hidden="true"></i> Limpiar Registro
            </button>
        </section>
    </div>

    <!-- Firebase - Tu Configuraci√≥n que YA FUNCIONA -->
    <script type="module">
        // (Mantengo el script igual, solo lo indent√© para claridad)
        try {
            console.log('üöÄ Iniciando Firebase para Farmacias...');
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js");
            const { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js");
            // Tu configuraci√≥n que YA FUNCIONA
            const firebaseConfig = {
                apiKey: "AIzaSyAaVSb70OFIoX48T9GbLmTcdXOSvKv2pRk",
                authDomain: "zona1561-4de30.firebaseapp.com",
                projectId: "zona1561-4de30",
                storageBucket: "zona1561-4de30.firebasestorage.app",
                messagingSenderId: "451366030738",
                appId: "1:451366030738:web:e638db51fbe24f6a48054b"
            };
            console.log('üìä Inicializando Firebase...');
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            // Hacer disponible globalmente
            window.firebaseApp = app;
            window.firebaseDB = db;
            window.firebaseCollection = collection;
            window.firebaseAddDoc = addDoc;
            window.firebaseGetDocs = getDocs;
            window.firebaseUpdateDoc = updateDoc;
            window.firebaseDeleteDoc = deleteDoc;
            window.firebaseDoc = doc;
            window.firebaseQuery = query;
            window.firebaseOrderBy = orderBy;
            window.firebaseReady = true;
            window.dispatchEvent(new CustomEvent('firebaseReady'));
            console.log('üî• Firebase para Farmacias listo');
        } catch (error) {
            console.error('‚ùå Error Firebase:', error);
            window.firebaseError = error;
            window.dispatchEvent(new CustomEvent('firebaseError', { detail: error }));
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script> <!-- Agregado defer para optimizaci√≥n -->
    <script src="script.js" defer></script> <!-- Agregado defer -->
</body>
</html>
